import { ArticleLayout } from '@/components/ArticleLayout'
import Image from 'next/image'
import amdModuleSystem from './custom-modules-amd-suitescript-vert.png'
import lodashInPackages from './lodash-package-location.png'

export const meta = {
  author: 'Alec Mingione',
  date: '2023-07-07',
  title: 'Introducing custom (library) modules for NetSuite SuiteScript',
  description:
    'Most NetSuite developers are familiar with the SuiteScript modules that NetSuite provides. These modules are a great way to get started with SuiteScript, but they have some limitations. In this article, we will explore how to use libraries compatible with the AMD engine using lodash for example.',
}

export default (props) => <ArticleLayout meta={meta} {...props} />

Most NetSuite developers are familiar with the **SuiteScript** *modules* that NetSuite provides. These modules are a great way to get started with SuiteScript, but they have some limitations. In this article, we will explore how to use libraries compatible with the AMD engine.


> **Note:** This article assumes you are familiar with the basics of SuiteScript and the AMD engine. If you are not, I recommend reading the [SuiteScript 2.x Modules](https://docs.oracle.com/en/cloud/saas/netsuite/ns-online-help/chapter_4220488571.html#SuiteScript-2.x-Modules) and [SuiteScript 2.0 AMD](https://docs.oracle.com/en/cloud/saas/netsuite/ns-online-help/section_4340365862.html#Asynchronous-Module-Definitions-(AMD)-and-RequireJS) articles on the NetSuite developer docs.
<Image src={amdModuleSystem} alt="" />

## ðŸ”§ What Is AMD?
AMD stands for *Asynchronous Module Definition*. It is a module system for JavaScript that allows you to load modules asynchronously. This is useful for loading modules in the browser, but it is also useful for loading modules in NetSuite. The AMD engine is built into NetSuite, and it is used to load the modules that NetSuite provides.
It is also used to load custom modules that you create.

## ðŸ¤” The Problem
The problem with the NetSuite modules is that there is community maintained code that we cannot use in our projects due to the AMD limitation. For example, we cannot use the popular [lodash](https://lodash.com/) library because how are we going to `define` **lodash** once we download it? This is a problem because lodash is a very useful library that can help us write better code. NetSuite doesn't have a dedicated package manager for *SuiteScript* modules, so we have to use a workaround.

## ðŸ“š The Solution
The solution is to use a library that is compatible with the AMD engine. There are many libraries that are compatible with the AMD engine, but we will use **lodash** for this example.

> There are also ways to use libraries that are not compatible with the AMD engine, but that is outside the scope of this article.

## Getting Into It
In this section, we will go over how to use **lodash** in our SuiteApp/Account Customization Project. We will also go over how to use **lodash** in our SuiteScript files.

> If you are starting from scratch I would create a new Account Customization Project. If you are adding this to an existing project, you can continue and follow along but notate the difference in folder/file stucture with the **SuiteApp** project type.

1. ### Downloading the library
    First, we need to download the **lodash** library. We can do this by running the following command in our terminal:

    ```bash
    npm install lodash
    ```
    ### OR
    You can download the **lodash** library from the [lodash](https://lodash.com/) website.

    > Now if you are using `bower` you can use the `bower install lodash` command. What will happen is we will have to **copy** the `lodash` output **folder** from `bower_componenets`  into the `SuiteScripts/packages` folder of our SuiteApp/Account Customization Project so it is accessible to the AMD engine within the *File Cabinet*.

    **NOTE**: To save you time and size (*memory*) in the file cabinet I recommend using the *GZIP* version of the library you choose to add to your project.
2. ### Adding the placement of all custom libraries
    Next, we need to create a new folder in our SuiteApp/Account Customization Project. We will call this folder `packages`. This folder will contain all of our custom *library* modules.
    > You will create the `packages` folder in the root of your SuiteApp/Account Customization Project.
    > Project types differ in the location the folder should be placed. See below for the location of the `packages` folder for each project type.
    > - **SuiteApp** Project Type: `src/FileCabinet/SuiteApps/YourSuiteApp/packages`
    > - **Account Customization** Project Type: `src/FileCabinet/SuiteScripts/packages`
3. ### Adding the library to the `packages` folder
    Next, we need to create a new folder in our `packages` folder. We will call this folder `@lodash`. This folder will contain the **lodash** library.
    > You will create the `@lodash` folder in the `packages` folder.
4. ### Copying the library into the `packages/@lodash` folder
    Now we need to copy the **lodash** library into our `packages` folder. We can do this by running the following command in our terminal:

    ```bash
    cp -r node_modules/lodash packages/@lodash
    ```
    ### OR
    If you downloaded the **lodash** library from the [lodash](https://lodash.com/) website you can copy the **lodash** library into the `packages` folder manually.
5. ### Lodash is ready to use! ðŸ¥§
    Now the library is in our `packages` folder it can be referenced by the AMD engine - Next stop using it in our SuiteScript files!
    > **After Inital Setup**: Your `packages` folder should look like this:
    > <Image src={lodashInPackages} alt="" />

## Using lodash in SuiteScript (any AMD library)
In this section, we will go over how to use **lodash** in our SuiteScript files. We will also go over how to use **lodash** in our SuiteApp/Account Customization Project.

### Setting up the AMD Configuration
Depending on how you have your project set up and if it is bundled or not you may have to make a logical decision on how to set up the AMD Configuration. For this example we will assume that we are using the **SuiteApp** project type that we are having to bundle for distribution.

1. ### Adding the AMD Configuration
    First, we need to add the AMD Configuration to our project. We can do this by adding the following code to our `gulpfile.js`:

    ```json
    {
      "baseUrl": "src/FileCabinet/SuiteApps/YourSuiteApp",
      "paths": {
        "lodash": "packages/@lodash/lodash"
      }
    }
    ```
    > You will add the AMD Configuration to your `gulpfile.js` in the root of your SuiteApp/Account Customization Project.
    > Project types differ in the location the `gulpfile.js` should be placed. See below for the location of the `gulpfile.js` for each project type.
    > - **SuiteApp** Project Type: `src/FileCabinet/SuiteApps/YourSuiteApp/gulpfile.js`
    > - **Account Customization** Project Type: `src/FileCabinet/SuiteScripts/gulpfile.js`





